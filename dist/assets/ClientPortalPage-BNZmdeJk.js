import{r as o,j as e,_ as w,R as C,S,W as D,c as P,B as T}from"./index-BJm5hHGn.js";import{u as k}from"./useScrollOnRouteChange-BTnMMuhU.js";import{S as I}from"./SearchIcon-DbBn6_4B.js";import{i as M}from"./formStyles-DqvmmO9K.js";import{D as L,B as A,P as E,C as $,f as B,d as O,e as R,a as W,b as _,c as z,p as F,X as H,E as V,L as X,A as Y}from"./ProjectTimelineChart-Dg6nh18f.js";import{A as q}from"./AnimatedMetric-BHxx1HCp.js";import{A as U}from"./AlertTriangleIcon-C8lQ2MQs.js";import{C as G}from"./CheckCircleIcon-BcO_1wd9.js";import{P as J}from"./ProjectIcon-NhewKK2n.js";$.register(B,O,R,W,_,z,F);const K=({project:s,tasks:n,hasOverdueTasks:a})=>{const p=o.useMemo(()=>{const l={"To Do":0,"In Progress":0,Done:0};return n.forEach(c=>{l[c.status]++}),{labels:["To Do","In Progress","Done"],datasets:[{data:[l["To Do"],l["In Progress"],l.Done],backgroundColor:["#f59e0b40","#3b82f640","#10b98140"],borderColor:["#f59e0b","#3b82f6","#10b981"],borderWidth:1}]}},[n]),h=o.useMemo(()=>{const l={Low:0,Medium:0,High:0};return n.forEach(c=>{l[c.priority]++}),{labels:["Low","Medium","High"],datasets:[{label:"Tasks by Priority",data:[l.Low,l.Medium,l.High],backgroundColor:["#3b82f680","#f59e0b80","#ef444480"],borderColor:["#3b82f6","#f59e0b","#ef4444"],borderWidth:1}]}},[n]),m={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{color:"#94a3b8"}}}},i={...m,plugins:{...m.plugins,legend:{display:!1}},scales:{y:{ticks:{color:"#94a3b8",stepSize:1}},x:{ticks:{color:"#94a3b8"}}}};return e.jsxs("div",{className:"bg-slate-900/50 border border-slate-800 rounded-lg p-6 mb-6 animate-fade-in",children:[e.jsxs("h3",{className:"text-3xl font-bold text-blue-300 mb-6 flex items-center gap-3",children:[s.title,a&&e.jsxs("span",{title:"This project has overdue tasks",className:"flex items-center gap-1 text-xs font-semibold text-red-400 bg-red-900/50 px-2 py-1 rounded-full",children:[e.jsx(U,{className:"w-4 h-4"})," Overdue"]})]}),s.caseStudy.keyMetrics&&s.caseStudy.keyMetrics.length>0&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6 text-center mb-8 p-6 bg-slate-800/40 border border-slate-700/50 rounded-lg",children:s.caseStudy.keyMetrics.map(l=>e.jsx(q,{value:l.value,label:l.label},l.label))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-slate-800/40 p-4 rounded-lg",children:[e.jsx("h4",{className:"text-lg font-semibold text-center text-slate-200 mb-4",children:"Task Status"}),e.jsx("div",{className:"h-64 relative",children:n.length>0?e.jsx(L,{data:p,options:m}):e.jsx("p",{className:"text-center text-slate-500 pt-20",children:"No tasks"})})]}),e.jsxs("div",{className:"bg-slate-800/40 p-4 rounded-lg",children:[e.jsx("h4",{className:"text-lg font-semibold text-center text-slate-200 mb-4",children:"Task Priority"}),e.jsx("div",{className:"h-64 relative",children:n.length>0?e.jsx(A,{data:h,options:i}):e.jsx("p",{className:"text-center text-slate-500 pt-20",children:"No tasks"})})]})]}),e.jsxs("div",{className:"mt-8 bg-slate-800/40 p-4 rounded-lg",children:[e.jsx("h4",{className:"text-lg font-semibold text-center text-slate-200 mb-4",children:"Project Timeline"}),e.jsx("div",{className:"h-96 relative",children:n.length>0?e.jsx(E,{tasks:n}):e.jsx("p",{className:"text-center text-slate-500 pt-32",children:"No tasks to display on timeline"})})]})]})},Q=({documents:s,searchTerm:n})=>s.length===0?e.jsxs("div",{className:"text-center py-16 bg-slate-900/50 border border-slate-800 rounded-lg",children:[e.jsx("p",{className:"text-xl font-semibold text-slate-300",children:n?"No Documents Found":"No Documents Available"}),e.jsx("p",{className:"text-slate-500 mt-2",children:n?`Your search for "${n}" did not match any documents.`:"There are currently no invoices or quotations for your account."})]}):e.jsx("div",{className:"bg-slate-900/70 border border-slate-800 rounded-lg overflow-hidden animate-fade-in",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left text-slate-300",children:[e.jsx("thead",{className:"text-xs text-slate-400 uppercase bg-slate-800/50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Number"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Type"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Date"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Total"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Status"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right",children:"Actions"})]})}),e.jsx("tbody",{children:s.map(a=>e.jsxs("tr",{className:"border-b border-slate-800 hover:bg-slate-800/30",children:[e.jsx("th",{scope:"row",className:"px-6 py-4 font-medium text-white whitespace-nowrap",children:a.documentNumber}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`text-xs font-bold px-2 py-1 rounded-full ${a.documentType==="Invoice"?"bg-green-900/50 text-green-300":"bg-purple-900/50 text-purple-300"}`,children:a.documentType})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:new Date(a.documentDate).toLocaleDateString()}),e.jsxs("td",{className:"px-6 py-4 font-mono",children:[a.currency,a.total.toFixed(2)]}),e.jsx("td",{className:"px-6 py-4",children:a.documentType==="Invoice"?e.jsxs("span",{className:`flex items-center gap-2 text-xs font-semibold px-2 py-1 rounded-full transition-colors ${a.paymentStatus==="paid"?"bg-green-500/20 text-green-300":"bg-yellow-500/20 text-yellow-300"}`,children:[a.paymentStatus==="paid"?e.jsx(G,{className:"w-4 h-4"}):e.jsx(H,{className:"w-4 h-4"}),a.paymentStatus==="paid"?"Paid":"Unpaid"]}):e.jsx("span",{className:"text-slate-500",children:"-"})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("a",{href:`/invoice/${a.publicId}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 text-xs font-semibold text-blue-400 hover:text-blue-300 bg-blue-900/50 hover:bg-blue-900/80 px-2 py-1 rounded-full transition-colors","aria-label":`View document ${a.documentNumber}`,children:[e.jsx(V,{className:"w-4 h-4"})," View"]})})]},a.id))})]})})}),ce=()=>{const{currentClient:s,logout:n}=w(),{navigate:a}=o.useContext(C),{projects:p,tasks:h,documentHistory:m}=o.useContext(S),[i,l]=o.useState(""),[c,j]=o.useState("projects");o.useEffect(()=>{s||a("/login")},[s,a]),k("/portal"),o.useEffect(()=>{const t=document.createElement("meta");return t.name="robots",t.content="noindex, nofollow",document.head.appendChild(t),()=>{document.head.removeChild(t)}},[]);const x=o.useMemo(()=>s?p.filter(t=>t.clientId===s.id):[],[p,s]),g=o.useMemo(()=>x.map(t=>t.slug),[x]),u=o.useMemo(()=>s?h.filter(t=>t.relatedProject&&g.includes(t.relatedProject)):[],[h,g,s]),b=o.useMemo(()=>s?m.filter(t=>t.clientId===s.id).sort((t,d)=>new Date(d.documentDate).getTime()-new Date(t.documentDate).getTime()):[],[m,s]),N=o.useMemo(()=>{const t=new Set,d=new Date;return u.forEach(r=>{r.status!=="Done"&&new Date(r.dueDate)<d&&t.add(r.relatedProject)}),t},[u]),f=o.useMemo(()=>{if(c!=="projects"||!i.trim())return x;const t=i.toLowerCase(),d=new Set(u.filter(r=>r.title.toLowerCase().includes(t)||r.description&&r.description.toLowerCase().includes(t)).map(r=>r.relatedProject));return x.filter(r=>r.title.toLowerCase().includes(t)||d.has(r.slug))},[i,x,u,c]),y=o.useMemo(()=>{if(c!=="documents"||!i.trim())return b;const t=i.toLowerCase();return b.filter(d=>d.documentNumber.toLowerCase().includes(t)||d.lineItems.some(r=>r.description.toLowerCase().includes(t)))},[i,b,c]);if(!s)return e.jsx("div",{className:"fixed inset-0 bg-slate-950 z-50"});const v=c==="projects"?`Search ${s.company}'s projects...`:"Search by document # or item...";return e.jsxs("div",{className:"bg-slate-950 text-white font-sans animate-content-fade-in min-h-screen",children:[e.jsx(D,{}),e.jsx("header",{className:"fixed top-0 left-0 right-0 z-30 bg-slate-950/80 backdrop-blur-lg border-b border-slate-800",children:e.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-20",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xl font-bold text-white",children:[e.jsx(P,{className:"w-8 h-8 text-blue-400"}),e.jsx("span",{children:"Prevaledge"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm text-slate-300 hidden sm:block",children:["Welcome, ",e.jsx("span",{className:"font-semibold text-white",children:s.company})]}),e.jsxs(T,{onClick:n,variant:"secondary",className:"!px-3 !py-2",children:[e.jsx(X,{className:"w-5 h-5"}),e.jsx("span",{className:"ml-2 hidden sm:inline",children:"Logout"})]})]})]})})}),e.jsx("main",{id:"top",className:"relative z-10 pt-24",children:e.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-16",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("header",{className:"text-center mb-12",children:[e.jsx("p",{className:"text-lg font-semibold text-blue-400",children:"Client Portal"}),e.jsxs("h1",{className:"text-4xl sm:text-5xl font-extrabold text-white mt-2",children:["Welcome, ",s.company]})]}),e.jsxs("section",{className:"mb-8 space-y-6",children:[e.jsx("div",{className:"border-b border-slate-800",children:e.jsxs("nav",{className:"-mb-px flex space-x-6","aria-label":"Tabs",children:[e.jsxs("button",{onClick:()=>j("projects"),className:`${c==="projects"?"border-blue-500 text-blue-400":"border-transparent text-slate-400 hover:text-slate-200 hover:border-slate-500"}
                            flex items-center gap-2 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors`,children:[e.jsx(J,{className:"w-5 h-5"})," Projects"]}),e.jsxs("button",{onClick:()=>j("documents"),className:`${c==="documents"?"border-blue-500 text-blue-400":"border-transparent text-slate-400 hover:text-slate-200 hover:border-slate-500"}
                            flex items-center gap-2 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors`,children:[e.jsx(Y,{className:"w-5 h-5"})," Billing & Documents"]})]})}),e.jsxs("div",{className:"relative max-w-lg mx-auto",children:[e.jsx(I,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-500 pointer-events-none"}),e.jsx("input",{type:"text",value:i,onChange:t=>l(t.target.value),placeholder:v,className:`${M} !pl-11`,"aria-label":"Search"})]})]}),c==="projects"&&e.jsx("div",{className:"space-y-12",children:f.length>0?f.map(t=>{const d=u.filter(r=>r.relatedProject===t.slug);return e.jsx(K,{project:t,tasks:d,hasOverdueTasks:N.has(t.slug)},t.id)}):i?e.jsxs("div",{className:"text-center py-16 bg-slate-900/50 border border-slate-800 rounded-lg",children:[e.jsx("p",{className:"text-xl font-semibold text-slate-300",children:"No Results Found"}),e.jsxs("p",{className:"text-slate-500 mt-2",children:['Your search for "',i,'" did not match any projects or tasks.']})]}):e.jsxs("div",{className:"text-center py-16 bg-slate-900/50 border border-slate-800 rounded-lg",children:[e.jsx("p",{className:"text-xl font-semibold text-slate-300",children:"No Projects Found"}),e.jsx("p",{className:"text-slate-500 mt-2",children:"There are currently no projects assigned to your portal."})]})}),c==="documents"&&e.jsx(Q,{documents:y,searchTerm:i})]})})})]})};export{ce as default};
